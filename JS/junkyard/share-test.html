<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share API Test - PWAkedex</title>
    <link rel="stylesheet" href="../../lib/bootstrap-5.3.8-dist/css/bootstrap.css">
    <link rel="stylesheet" href="../../CSS/style.css">
</head>
<body class="text-light p-5">
    <div class="container">
        <h1 class="mb-4">Web Share API Test</h1>
        
        <div class="card bg-dark text-light mb-4">
            <div class="card-body">
                <h3>Browser Capabilities</h3>
                <div id="capabilities"></div>
            </div>
        </div>
        
        <div class="card bg-dark text-light mb-4">
            <div class="card-body">
                <h3>Test Buttons</h3>
                <button id="test-share-text" class="btn btn-primary m-2">Share Text Only</button>
                <button id="test-share-url" class="btn btn-primary m-2">Share with URL</button>
                <button id="test-share-image" class="btn btn-primary m-2">Share with Image</button>
                <button id="test-clipboard" class="btn btn-secondary m-2">Test Clipboard</button>
            </div>
        </div>
        
        <div class="card bg-dark text-light">
            <div class="card-body">
                <h3>Console Output</h3>
                <pre id="console-output" class="bg-black text-success p-3" style="max-height: 300px; overflow-y: auto;"></pre>
            </div>
        </div>
    </div>
    
    <script type="module">
        const output = document.getElementById('console-output');
        const capabilities = document.getElementById('capabilities');
        
        function log(msg) {
            console.log(msg);
            output.textContent += msg + '\n';
            output.scrollTop = output.scrollHeight;
        }
        
        // Check capabilities
        log('=== Checking Browser Capabilities ===');
        log(`navigator.share: ${typeof navigator.share === 'function' ? '‚úÖ Supported' : '‚ùå Not supported'}`);
        log(`navigator.canShare: ${typeof navigator.canShare === 'function' ? '‚úÖ Supported' : '‚ùå Not supported'}`);
        log(`navigator.clipboard: ${navigator.clipboard ? '‚úÖ Supported' : '‚ùå Not supported'}`);
        
        let capsHTML = '<ul class="list-unstyled">';
        capsHTML += `<li>üì± Web Share API: ${typeof navigator.share === 'function' ? '‚úÖ' : '‚ùå'}</li>`;
        capsHTML += `<li>üì∏ File Sharing: ${typeof navigator.canShare === 'function' ? '‚úÖ' : '‚ùå'}</li>`;
        capsHTML += `<li>üìã Clipboard API: ${navigator.clipboard ? '‚úÖ' : '‚ùå'}</li>`;
        capsHTML += '</ul>';
        capabilities.innerHTML = capsHTML;
        
        // Test share text only
        document.getElementById('test-share-text').addEventListener('click', async function() {
            log('\nüì§ Testing text share...');
            if (!navigator.share) {
                log('‚ùå Web Share API not supported');
                return;
            }
            try {
                await navigator.share({
                    title: 'Test Share',
                    text: 'Testing PWAkedex share functionality'
                });
                log('‚úÖ Share successful');
            } catch (error) {
                log(`‚ùå Share failed: ${error.name} - ${error.message}`);
            }
        });
        
        // Test share with URL
        document.getElementById('test-share-url').addEventListener('click', async function() {
            log('\nüì§ Testing URL share...');
            if (!navigator.share) {
                log('‚ùå Web Share API not supported');
                return;
            }
            try {
                await navigator.share({
                    title: 'Pikachu (#025) - PWAkedex',
                    text: 'Check out Pikachu, a electric type Pok√©mon! üê≤',
                    url: window.location.origin + '/collinso/pwakedex/pokemon-detail.html?id=25'
                });
                log('‚úÖ Share successful');
            } catch (error) {
                log(`‚ùå Share failed: ${error.name} - ${error.message}`);
            }
        });
        
        // Test share with image
        document.getElementById('test-share-image').addEventListener('click', async function() {
            log('\nüì§ Testing image share...');
            if (!navigator.canShare) {
                log('‚ùå File sharing not supported');
                return;
            }
            
            try {
                // Fetch Pikachu sprite
                const response = await fetch('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png');
                const blob = await response.blob();
                const file = new File([blob], 'pikachu.png', { type: 'image/png' });
                
                if (!navigator.canShare({ files: [file] })) {
                    log('‚ùå Browser cannot share files');
                    return;
                }
                
                await navigator.share({
                    title: 'Pikachu (#025) - PWAkedex',
                    text: 'Check out Pikachu! üê≤',
                    files: [file]
                });
                log('‚úÖ Image share successful');
            } catch (error) {
                log(`‚ùå Image share failed: ${error.name} - ${error.message}`);
            }
        });
        
        // Test clipboard
        document.getElementById('test-clipboard').addEventListener('click', async function() {
            log('\nüìã Testing clipboard...');
            if (!navigator.clipboard) {
                log('‚ùå Clipboard API not supported');
                return;
            }
            
            try {
                const testUrl = window.location.origin + '/collinso/pwakedex/pokemon-detail.html?id=25';
                await navigator.clipboard.writeText(testUrl);
                log('‚úÖ Copied to clipboard: ' + testUrl);
            } catch (error) {
                log(`‚ùå Clipboard failed: ${error.name} - ${error.message}`);
            }
        });
    </script>
</body>
</html>
